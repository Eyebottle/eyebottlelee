# MSIX 개발 테스트 가이드 (GUI 방식)

개발 중인 MSIX 패키지를 로컬에서 설치하고 테스트하는 방법을 안내합니다.

---

## 📋 사전 준비

### MSIX 파일 위치 확인
빌드된 MSIX 파일 경로:
```
C:\ws-workspace\eyebottlelee\build\windows\x64\runner\Release\medical_recorder.msix
```

---

## 1️⃣ Windows 개발자 모드 활성화

MSIX 개발 버전(자체 서명 인증서)을 설치하려면 Windows 개발자 모드가 필요합니다.

### 🔧 Windows 11 설정 방법

1. **Windows 설정 열기**
   - `Win + I` 키를 누르거나
   - 시작 메뉴 → 설정 클릭

2. **개인정보 및 보안 → 개발자용 메뉴 선택**
   - 왼쪽 메뉴에서 `개인정보 및 보안` 클릭
   - 오른쪽에서 `개발자용` 클릭

3. **개발자 모드 켜기**
   - `개발자 모드` 스위치를 **켜짐**으로 변경
   - 확인 대화상자가 나타나면 **예** 클릭

4. **설정 완료**
   - 재시작은 필요하지 않습니다
   - 바로 다음 단계로 진행 가능

### 🔧 Windows 10 설정 방법

1. **Windows 설정 열기**
   - `Win + I` 키

2. **업데이트 및 보안 → 개발자용 메뉴 선택**

3. **개발자 모드 선택**
   - `개발자 모드` 라디오 버튼 선택
   - 확인 대화상자가 나타나면 **예** 클릭

---

## 2️⃣ 기존 앱 제거 (필요한 경우)

이전에 설치한 버전이 있다면 먼저 제거해야 합니다.

### 방법 1: Windows 설정에서 제거

1. **앱 목록 열기**
   - `Win + I` → 앱 → 설치된 앱 (Windows 11)
   - 또는 `Win + I` → 앱 → 앱 및 기능 (Windows 10)

2. **아이보틀 진료녹음 앱 찾기**
   - 검색창에 "아이보틀" 또는 "Eyebottle" 입력

3. **제거**
   - 앱 오른쪽의 `⋮` (점 3개) 클릭 → **제거**
   - 확인 대화상자에서 **제거** 클릭

### 방법 2: PowerShell에서 제거 (고급)

PowerShell을 관리자 권한으로 실행한 후:

```powershell
Get-AppxPackage -Name "DCD952CB.367669DCDC1D3" | Remove-AppxPackage
```

---

## 3️⃣ MSIX 파일 설치

### 🖱️ 간편 설치 방법

1. **파일 탐색기 열기**
   - `Win + E` 키

2. **MSIX 파일로 이동**
   ```
   C:\ws-workspace\eyebottlelee\build\windows\x64\runner\Release
   ```

3. **medical_recorder.msix 파일 더블클릭**

4. **설치 대화상자에서 [설치] 버튼 클릭**
   - "이 앱이 디바이스를 변경할 수 있도록 허용하시겠습니까?" → **예**

5. **설치 완료 대기**
   - 진행률 표시줄이 100%가 될 때까지 대기
   - 설치가 완료되면 **시작** 버튼이 활성화됩니다

6. **[시작] 버튼 클릭 또는 나중에 시작 메뉴에서 실행**

---

## 4️⃣ 설치 확인

### ✅ 앱이 정상 설치되었는지 확인

1. **시작 메뉴 열기**
   - `Win` 키 누르기

2. **앱 검색**
   - "아이보틀" 또는 "Eyebottle" 입력

3. **앱 실행**
   - 검색 결과에서 "아이보틀 진료녹음 & 자동실행 매니저" 클릭

---

## 5️⃣ 백그라운드 시작 기능 테스트 (v1.3.4)

### 테스트 목적
Windows 부팅 시 앱이 백그라운드(트레이)로 자동 시작되는지 확인합니다.

### 🧪 테스트 절차

#### 단계 1: 자동 시작 설정 활성화

1. **앱 실행**
   - 시작 메뉴에서 앱 실행

2. **설정 화면으로 이동**
   - 메인 화면 오른쪽 상단의 `설정 (⚙️)` 버튼 클릭
   - 또는 `Windows 시작` 카드 클릭

3. **Windows 시작 설정 확인**
   - `Windows 시작 시 자동 실행` 토글을 **켜짐**으로 설정
   - 상태: `켜짐 · 창 표시` 또는 `켜짐 · 백그라운드`로 표시됨

#### 단계 2: 백그라운드 시작 옵션 활성화

1. **설정 화면에서 스크롤**
   - `부팅 시 백그라운드로 시작` 토글을 **켜짐**으로 설정

2. **상태 확인**
   - Windows 시작 카드 상태가 `켜짐 · 백그라운드`로 변경됨

3. **저장**
   - `저장` 버튼 클릭 (자동 저장되는 경우 생략)

#### 단계 3: PC 재시작

1. **앱 종료**
   - 창을 닫거나, 트레이 아이콘 우클릭 → `종료`

2. **PC 재시작**
   - 시작 메뉴 → 전원 → **다시 시작**

#### 단계 4: 부팅 후 확인

1. **Windows 로그인 후 대기**
   - 약 5~10초 대기

2. **트레이 아이콘 확인**
   - 작업 표시줄 오른쪽 하단의 시스템 트레이(^) 클릭
   - 아이보틀 아이콘(🎤 또는 앱 로고)이 있는지 확인

3. **창이 뜨지 않았는지 확인**
   - 백그라운드 모드에서는 창이 표시되지 않고 트레이에만 존재해야 함

4. **트레이 아이콘 클릭하여 창 열기**
   - 트레이 아이콘을 더블클릭하거나 우클릭 → `창 보기`
   - 창이 정상 크기(660×980)로 열리는지 확인

---

## 6️⃣ 로그 확인 (문제 해결)

백그라운드 시작이 제대로 작동하지 않을 경우, 로그 파일을 확인하여 원인을 파악할 수 있습니다.

### 📂 로그 파일 위치

```
C:\Users\user\OneDrive\문서\EyebottleRecorder\logs\eyebottle_YYYYMMDD.log
```

예시:
```
C:\Users\user\OneDrive\문서\EyebottleRecorder\logs\eyebottle_20251121.log
```

### 🔍 확인할 로그 메시지

정상 동작 시 다음 로그가 기록되어야 합니다:

```
[INFO] 앱이 자동 실행 모드(--autostart)로 시작되었습니다.
[INFO] Autostart check: shouldStartMinimized=true
[INFO] Started minimized to tray (background mode)
```

#### 비정상 케이스

- **`앱이 일반 모드로 시작되었습니다. args=[]`**
  - Windows가 `--autostart` 플래그를 전달하지 않음
  - 해결: MSIX 재설치, Windows 시작 설정 다시 활성화

- **`Autostart check: shouldStartMinimized=false`**
  - 사용자 설정에서 백그라운드 시작이 꺼져 있음
  - 해결: 앱 설정에서 `부팅 시 백그라운드로 시작` 켜기

- **`Started normally (visible window)`**
  - 백그라운드 시작 대신 창이 표시됨
  - 위 두 경우 중 하나가 원인

---

## 7️⃣ 일반 시작 모드 테스트

백그라운드 시작을 끄고, 정상 창 표시 모드도 테스트합니다.

### 🧪 테스트 절차

1. **설정 변경**
   - `부팅 시 백그라운드로 시작` 토글을 **꺼짐**으로 설정
   - 상태: `켜짐 · 창 표시`로 변경됨

2. **PC 재시작**

3. **부팅 후 확인**
   - 앱 창이 자동으로 표시되는지 확인
   - 창 크기가 660×980 (설정된 크기)인지 확인

---

## ❌ 문제 해결

### 문제 1: "이 앱 패키지의 게시자 인증서를 확인할 수 없습니다"

**원인:** 개발자 모드가 활성화되지 않았습니다.

**해결:**
- 위 [1️⃣ Windows 개발자 모드 활성화](#1️⃣-windows-개발자-모드-활성화) 단계 수행

### 문제 2: MSIX 파일 더블클릭 시 아무 반응 없음

**원인:** 파일 연결 설정이 손상되었을 수 있습니다.

**해결:**
PowerShell에서 수동 설치:
```powershell
Add-AppxPackage -Path "C:\ws-workspace\eyebottlelee\build\windows\x64\runner\Release\medical_recorder.msix"
```

### 문제 3: 설치 시 "0x80073CF3" 오류

**원인:** 기존 버전이 완전히 제거되지 않았습니다.

**해결:**
1. [2️⃣ 기존 앱 제거](#2️⃣-기존-앱-제거-필요한-경우) PowerShell 방법 사용
2. 재시도

### 문제 4: 백그라운드 시작 시 창이 뜬다

**원인:** 설정이 제대로 저장되지 않았거나, 로그에 원인이 기록되어 있습니다.

**해결:**
1. [6️⃣ 로그 확인](#6️⃣-로그-확인-문제-해결) 단계 수행
2. 설정 다시 확인 및 저장

### 문제 5: 트레이 아이콘 클릭 시 창 크기가 이상함

**원인:** DPI 스케일링 또는 초기화 타이밍 문제

**해결:**
1. 앱 완전 종료 (트레이 아이콘 우클릭 → 종료)
2. 시작 메뉴에서 다시 실행
3. 문제 지속 시 로그 확인

---

## 📌 요약

| 단계 | 작업 | 소요 시간 |
|------|------|-----------|
| 1 | 개발자 모드 활성화 | 1분 |
| 2 | 기존 앱 제거 (필요시) | 1분 |
| 3 | MSIX 설치 | 1분 |
| 4 | 설정 확인 | 1분 |
| 5 | 재시작 후 테스트 | 5분 |

**총 소요 시간: 약 10분**

---

## 🔗 관련 문서

- `docs/MS-STORE-GUIDE.md` - MS Store 제출 가이드
- `docs/ms-store-info.md` - MS Store 정보
- `pubspec.yaml` - MSIX 설정 (msix_config 섹션)

---

## 📝 버전 정보

- **문서 버전:** 1.0
- **앱 버전:** v1.3.4
- **작성일:** 2025-11-21
- **테스트 기능:** Windows 부팅 시 백그라운드 시작
