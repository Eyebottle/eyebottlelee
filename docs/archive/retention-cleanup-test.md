# 저장기간 자동 정리 기능 테스트 가이드

## 📋 개요

저장기간 자동 정리 기능은 설정한 기간(1주일, 1개월 등)이 지난 녹음 파일을 자동으로 삭제하는 기능입니다.

**테스트 방법**: 2주 전 날짜의 더미 파일을 생성하여 1주일 보관 기간으로 설정 시 자동 삭제되는지 확인합니다.

---

## ✅ 사전 준비

- 개발 PC 환경 (Windows)
- 아이보틀 진료 녹음 앱 설치
- PowerShell 실행 권한

---

## 🧪 테스트 절차

### 1단계: 더미 파일 생성

PowerShell(관리자 권한 불필요)을 열고:

```powershell
cd C:\ws-workspace\eyebottlelee
.\scripts\windows\test-retention-cleanup.ps1
```

**출력 예시:**
```
✅ rec_2025-10-23_020000.m4a
   크기: 48.83 KB | 수정일: 2025-10-23 02:00:00
✅ rec_2025-10-23_040000.m4a
   크기: 48.83 KB | 수정일: 2025-10-23 04:00:00
✅ rec_2025-10-23_060000.m4a
   크기: 48.83 KB | 수정일: 2025-10-23 06:00:00
```

### 2단계: 앱에서 보관 기간 설정

1. 아이보틀 진료 녹음 앱 실행
2. **설정 탭** 클릭
3. **"녹음 파일 보관 기간"** 클릭
4. **"1주일"** 선택
5. **"저장"** 버튼 클릭

### 3단계: 정리 기능 트리거

**방법 A**: 녹음 시작
- 대시보드 탭 > **"녹음 시작"** 버튼 클릭
- 즉시 중지해도 됨 (정리 함수는 이미 실행됨)

**방법 B**: 이미 녹음 중이면
- **"녹음 중지"** 버튼 클릭

### 4단계: 결과 확인

#### A. 로그 확인
앱 하단 로그에서 다음 메시지 확인:
```
🧹 보관 정책 적용 중...
보관기간 경과 파일 삭제: rec_2025-10-23_020000.m4a
보관기간 경과 파일 삭제: rec_2025-10-23_040000.m4a
보관기간 경과 파일 삭제: rec_2025-10-23_060000.m4a
```

#### B. 파일 탐색기 확인
1. 파일 탐색기 열기
2. 경로 이동: `%USERPROFILE%\OneDrive\진료녹음`
3. `2025-10-23` 폴더 확인:
   - ✅ **폴더가 삭제됨** → 테스트 성공!
   - ❌ **파일이 남아있음** → 테스트 실패 (로그 확인 필요)

---

## 🔍 예상 결과

### 성공 시나리오
```
Before:
📁 진료녹음/
  └── 📁 2025-10-23/
      ├── rec_2025-10-23_020000.m4a (14일 전)
      ├── rec_2025-10-23_040000.m4a (14일 전)
      └── rec_2025-10-23_060000.m4a (14일 전)

After:
📁 진료녹음/
  (빈 폴더 또는 2025-10-23 폴더 자체가 삭제됨)
```

### 실패 시나리오

**증상**: 파일이 삭제되지 않음

**원인 및 해결**:
1. **보관 기간이 "영구 보존"으로 설정됨**
   - 해결: 설정에서 "1주일"로 변경 후 재시도

2. **로그에 에러 메시지**
   - 해결: 로그 내용 확인 후 원인 파악

3. **앱이 정리 함수를 실행하지 않음**
   - 해결: 앱 재시작 후 녹음 시작/중지 재시도

---

## 📊 테스트 결과 기록

| 항목 | 결과 | 비고 |
|------|------|------|
| 더미 파일 생성 | ⬜ | 3개 파일 생성 확인 |
| 보관 기간 설정 | ⬜ | 1주일로 설정 |
| 정리 함수 실행 | ⬜ | 로그 메시지 확인 |
| 파일 삭제 확인 | ⬜ | 탐색기에서 확인 |
| 빈 폴더 정리 | ⬜ | 2025-10-23 폴더 삭제 |

---

## 🔧 추가 테스트 (선택)

### 다양한 보관 기간 테스트

```powershell
# 30일 전 파일 생성
.\scripts\windows\test-retention-cleanup.ps1 -DaysAgo 30

# 앱에서 "1개월" 설정 → 삭제 안 됨 (30일 = 경계값)
# 앱에서 "1주일" 설정 → 삭제 됨
```

### 커스텀 저장 경로 테스트

```powershell
# 다른 경로에 더미 파일 생성
.\scripts\windows\test-retention-cleanup.ps1 -RecordingPath "D:\진료녹음"
```

---

## 📝 테스트 완료 후

- ✅ 테스트 성공 확인 시: **코드 변경 없이 진료실 배포 진행**
- ❌ 테스트 실패 시: 로그 및 에러 메시지 수집 후 디버깅

---

**테스트 작성일**: 2025-11-06
**문서 버전**: 1.0
