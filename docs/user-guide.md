# 아이보틀 진료 녹음 사용 가이드

이 문서에서는 처음 설치부터 일상적인 진료 녹음, 문제 해결까지 전 과정을 안내합니다. Windows 데스크톱 환경을 기준으로 설명하며, WSL에서 개발하고 Windows에서 실행하는 워크플로우를 전제로 합니다.

---

## 1. 준비 사항

### 1.1 필수 설치
- Flutter 3.35.3 (Windows Desktop 지원 활성화)
- Visual Studio 2022 Community (Desktop development with C++)
- OneDrive(선택) — 파일 동기화용
- USB/유선 마이크 또는 Windows 기본 입력 장치

### 1.2 경로 구성
| 위치 | 용도 | 기본 경로 |
| --- | --- | --- |
| WSL 개발 경로 | 코드 작성 | `/home/<user>/projects/eyebottlelee` |
| Windows 실행 경로 | Flutter Windows 빌드 | `C:\ws-workspace\eyebottlelee` |

post-commit 훅이 자동으로 WSL → Windows 복사를 수행합니다. 수동으로 동기화하려면:
```bash
bash scripts/sync_wsl_to_windows.sh
```

---

## 2. 첫 실행 체크리스트
1. Windows PowerShell에서 `flutter run -d windows` 실행
2. 앱 실행 후 다음 항목을 확인합니다.
   - 마이크 권한 허용 여부 (필요시 Windows 설정 > 개인정보 > 마이크에서 활성화)
   - 기본 진료 시간표 (월~금 오전 09:00-13:00, 오후 14:00-18:00)
   - 저장 폴더 (기본은 앱 문서 폴더, OneDrive 폴더 선택 권장)
   - 자동 마이크 점검 카드가 “정상” 혹은 “주의” 메시지를 표시하는지 확인

---

## 3. 대시보드 살펴보기
| 영역 | 설명 |
| --- | --- |
| 녹음 상태 카드 | 현재 녹음 상태, 누적 시간, 수동 시작/중지 버튼 |
| 오늘 일정 | 오늘 예정된 진료 세션 목록 (AM/PM) |
| 마이크 점검 카드 | 최근 진단 결과, “다시 점검” 버튼 |
| 저장 경로 카드 | 현재 저장 위치 및 보관 정책 |

> **팁:** 메인 화면 우측 상단의 `?` 버튼에서 언제든 “도움말 & 빠른 시작”을 열 수 있습니다.

---

## 4. 녹음 흐름
1. **자동 녹음**: 진료 시간표에 따라 자동으로 시작/정지합니다.
2. **수동 제어**: 대시보드 또는 트레이 아이콘에서 “녹음 시작/중지”를 선택해 즉시 제어할 수 있습니다.
3. **세그먼트 분할**: 10분마다 자동으로 파일이 분할되며, `YYYY-MM-DD` 폴더로 정리됩니다.
4. **무음 스킵**: VAD(무음 감지)가 활성화되면 작은 소리도 놓치지 않도록 민감도가 조정됩니다.

---

## 5. 스케줄 및 보관 설정
1. 메인 화면 → **설정 탭** → “진료 시간표 설정”
2. 요일별로 오전/오후 구간을 켜고 시간 범위를 조정합니다.
3. 고급 설정에서 다음 항목을 관리합니다.
   - 녹음 품질 · 민감도 (64/48/32kbps 프로필 + 조용한 환경 보정 0~+12dB)
   - VAD 민감도 (기본 0.006, 조용한 진료실이면 0.004 권장)
   - 파일 보관 기간 (영구/1주/1개월 등)
   - Windows 자동 실행 토글

변경 사항은 즉시 저장되며 SharedPreferences에 기록됩니다.

---

## 6. 시스템 트레이 사용법
- 창 닫기 혹은 `Alt+F4` → 앱은 종료되지 않고 트레이로 숨습니다.
- 트레이 아이콘 좌/더블 클릭 → 메인 창 다시 열기
- 우클릭 메뉴 항목:
  - **녹음 시작/중지** (현재 상태에 따라 토글)
  - **마이크 점검** (3초 샘플로 진단)
  - **설정 열기** (메인 창 포커스)
  - **종료** (녹음을 안전하게 중단하고 앱 종료)
- 아이콘 색상: 녹음(빨강), 대기(초록), 오류(노랑)

---

## 7. 자동 마이크 점검 해석
| 상태 | 평균 레벨(dBFS) | SNR(dB) | 설명 | 권장 조치 |
| --- | --- | --- | --- | --- |
| 정상 | ≥ -24 또는 -33 이상 & SNR ≥ 6 | ≥ 6 | 입력 레벨이 충분합니다. | 추가 조치 없음 |
| 낮음 | -33 ~ -24 | 3~6 | 약간 낮은 수준입니다. | 마이크 위치 조정, Windows 입력 볼륨 ↑ |
| 매우 낮음 | < -33 | < 3 | 소리가 거의 들어오지 않습니다. | 케이블/음소거 확인, 장치 재선택 |
| 권한/장치 오류 | - | - | 권한 거부 또는 장치 미검출 | Windows 설정에서 권한/기본 장치 확인 |

**도움말 버튼**을 눌러 민감도 조정 가이드를 확인할 수 있습니다.

---

## 8. 저장 및 동기화
1. 기본 저장 경로는 앱 문서 디렉터리입니다.
2. **저장 폴더 선택**에서 OneDrive 폴더를 지정하면 자동으로 클라우드에 동기화됩니다.
3. 보관 기간을 설정하면 지정된 기간 이후 파일이 자동 삭제되며 빈 날짜 폴더도 정리됩니다.

> **주의:** OneDrive가 동기화 중일 때는 삭제된 파일이 휴지통으로 이동할 수 있으므로, 장기 보관은 OneDrive 정책을 확인하세요.

---

## 9. 문제 해결 & FAQ
- **녹음 시작 실패**: 마이크 권한, 장치 연결 상태, 다른 앱의 점유 여부 확인
- **트레이 아이콘 미표시**: `scripts/windows/generate-placeholder-icons.ps1`로 아이콘 생성 후 앱 재실행
- **자동 시작이 적용되지 않음**: 관리자 권한 부족 또는 개발 경로 문제일 수 있습니다. 고급 설정에서 토글을 껐다가 다시 켜보세요.
- **스케줄이 적용되지 않음**: SharedPreferences 초기화 필요 시 설정 저장 후 앱을 재시작하세요.

추가 질문은 `docs/developing.md`의 문제 해결 섹션 또는 팀 Slack 채널을 참고하세요.

---

## 10. 추가 리소스
- 개발 가이드: [docs/developing.md](./developing.md)
- 제품 요구사항(PRD): [docs/medical-recording-prd.md](./medical-recording-prd.md)
- 동기화 워크플로우: [docs/sync-workflow.md](./sync-workflow.md)
- 아이콘 생성 스크립트: `scripts/windows/generate-placeholder-icons.ps1`
- 설치 가이드: [INSTALL.md](../INSTALL.md)

---

## 11. 앱 내 도움말/튜토리얼
- 메인 화면 우측 상단 `도움말` 버튼 → “도움말 & 빠른 시작” 다이얼로그 열기
- 다이얼로그의 `대시보드 튜토리얼` 버튼 → 녹음 상태 카드, 일정 요약, 트레이 안내를 순차적으로 하이라이트
- `설정 튜토리얼` 버튼 → 시간표, 저장 위치, 녹음 품질·민감도, 보관 기간, VAD, 자동 실행 항목을 차례로 안내
- 시스템 트레이 메뉴의 `도움말` 항목에서도 동일하게 호출 가능하며, 튜토리얼은 언제든지 반복 실행할 수 있습니다.
- 상세 설명은 GitHub의 최신 사용자 가이드와 연동됩니다.

즐거운 진료 녹음 작업을 위해 주기적으로 마이크 입력을 점검하고, 스케줄/보관 정책을 최신 상태로 유지하세요!
## 12. 테스트앱 설치 & 진료실 검증
1. **패키지 수령**: 개발 PC에서 `flutter build windows --release` 후 생성된 `build\windows\x64\runner\Release` 폴더를 ZIP으로 묶어 진료실 PC로 전달합니다. MSIX가 필요한 경우 `dart run msix:create` 결과를 함께 제공합니다.
2. **검증 전 준비**: 진료실 PC에 마이크와 스피커를 연결하고, Windows 사운드 설정에서 기본 입력 장치를 확인합니다. OneDrive를 사용한다면 동기화가 완료됐는지 상태 아이콘을 확인합니다.
3. **설치 및 실행**: ZIP을 원하는 위치에 풀고 `Eyebottle Medical Recorder.exe`를 실행합니다. 첫 실행 시 마이크 권한 요청이 뜨면 허용합니다.
4. **초기 체크리스트**:
   - 마이크 점검 카드가 "정상" 또는 "주의" 상태로 표시되는지 확인
   - 고급 설정에서 테스트에 사용할 녹음 품질·민감도 프리셋을 선택
   - 저장 폴더를 테스트용 OneDrive 경로 또는 로컬 전용 폴더로 지정
   - 자동 시작이 필요 없다면 비활성화하여 진료 PC를 깔끔하게 유지
5. **3단계 사용성 테스트**:
   - **준비 레코딩**: 트레이 메뉴의 "마이크 점검"으로 3초 샘플을 재검사하고, 진료실 배경 소리에서도 "정상" 판정이 나오는지 확인합니다.
   - **시나리오 녹음**: 모의 진료를 15분 이상 진행하며 작은 목소리·속삭임·기기 소음 등 다양한 입력을 테스트합니다. 세그먼트가 10분 단위로 분리되고 파일명이 날짜별 폴더에 정리되는지 확인합니다.
   - **종료·리뷰**: 녹음을 종료하고 저장 폴더에서 파일 크기와 메타 로그(`EyebottleRecorder/logs`)를 확인한 뒤, 필요한 경우 메이크업 게인이나 VAD 임계값을 조정합니다.
6. **Soak 테스트(선택)**: 장시간 안정성을 검증하려면 PowerShell에서 `pwsh -File scripts\windows\run-soak-test.ps1`를 실행해 8시간 테스트를 진행하고, 생성된 `metrics.csv`와 로그를 검토합니다.
7. **피드백 기록**: 문제나 개선점은 `docs/developing.md` 체크리스트와 비교해 기록하고, 팀 공유 채널에 로그·스크린샷을 첨부합니다.

