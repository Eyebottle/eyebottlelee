# MSIX 설치 테스트 체크리스트

MS Store 제출 전 MSIX 패키지가 정상 작동하는지 확인하는 가이드입니다.

---

## 🎯 테스트 목적

MSIX로 설치했을 때와 일반 실행 파일(.exe)로 실행했을 때의 차이점을 확인합니다.

**MSIX 특징:**
- Windows 샌드박스 환경에서 실행
- 제한된 파일 시스템 접근 (AppData 폴더만 가능)
- 깔끔한 설치/제거 (레지스트리 변경 최소화)
- MS Store와 동일한 방식으로 동작

**테스트가 중요한 이유:**
- MS Store에 올린 후 문제가 발견되면 수정/재제출에 시간이 오래 걸림
- 로컬에서 미리 문제를 발견하고 수정할 수 있음

---

## 📋 사전 준비

### 1. 개발자 모드 활성화

**Windows 11:**
```
설정 → 개인정보 보호 및 보안 → 개발자용 → "개발자 모드" 토글 켜기
```

**Windows 10:**
```
설정 → 업데이트 및 보안 → 개발자용 → "개발자 모드" 선택
```

### 2. 이전 버전 제거 (있다면)

```powershell
# PowerShell 관리자 권한으로 실행
Get-AppxPackage | Where-Object {$_.Name -like "*eyebottle*"}

# 출력된 패키지가 있으면 제거
Remove-AppxPackage -Package "패키지전체이름"
```

---

## ✅ 1단계: 설치 테스트

### 설치 실행

```powershell
cd C:\ws-workspace\eyebottlelee\build\windows\x64\runner\Release
Add-AppxPackage -Path medical_recorder.msix
```

또는:
```
medical_recorder.msix 파일 더블클릭 → "설치" 버튼 클릭
```

### 확인 항목

- [ ] **설치 진행**
  - 오류 없이 설치 진행됨
  - 설치 완료 메시지 표시

- [ ] **시작 메뉴 등록**
  - 시작 메뉴 → "아이보틀 진료 녹음" 검색
  - 타일이 표시되고 클릭 가능

- [ ] **아이콘 표시**
  - 타일 아이콘이 eyebottle 로고로 표시됨
  - 흐릿하거나 깨지지 않음

**❌ 설치 실패 시:**
```
오류 메시지를 확인하고:
1. 개발자 모드 활성화 확인
2. 이전 버전 완전 제거
3. PowerShell 관리자 권한으로 재시도
```

---

## ✅ 2단계: 기본 기능 테스트

### A. 앱 실행

- [ ] 시작 메뉴에서 "아이보틀 진료 녹음" 클릭
- [ ] 앱이 3초 이내에 실행됨
- [ ] 메인 화면이 정상 표시됨
- [ ] 로딩 오류 없음

### B. 초기 설정 확인

- [ ] **마이크 권한 요청**
  - 첫 실행 시 마이크 권한 요청 팝업
  - "허용" 클릭

- [ ] **저장 폴더 선택**
  - 기본값: OneDrive 폴더 또는 문서 폴더
  - 폴더 선택 다이얼로그가 정상 작동

- [ ] **설정 저장 확인**
  - 설정 변경 후 앱 재시작
  - 설정이 유지되는지 확인

**⚠️ 주의:**
MSIX 앱은 다음 위치에만 파일 저장 가능:
- `%LOCALAPPDATA%\Packages\eyebottle.medical.recorder_*\LocalState\`
- 사용자가 선택한 폴더 (OneDrive, 문서 등)

---

## ✅ 3단계: 핵심 기능 테스트

### A. 녹음 기능

- [ ] **녹음 시작**
  - "녹음 시작" 버튼 클릭
  - 버튼이 "녹음 중지"로 변경됨
  - 볼륨 미터가 움직임

- [ ] **녹음 진행**
  - 타이머가 정상 작동 (00:00:01, 00:00:02...)
  - 볼륨 레벨이 마이크 입력에 반응

- [ ] **녹음 중지**
  - "녹음 중지" 버튼 클릭
  - 녹음이 정상 중지됨
  - 저장 완료 메시지 (선택적)

### B. 파일 저장 확인

- [ ] **WAV 파일 생성**
  - 저장 폴더에 WAV 파일 생성됨
  - 파일명 형식: `YYYYMMDD_HHmmss.wav`

- [ ] **AAC 변환 확인** (중요!)
  - 녹음 중지 후 5초 대기
  - WAV 파일이 AAC로 변환됨
  - 원본 WAV 파일이 삭제됨
  - AAC 파일 크기가 WAV보다 훨씬 작음

**예상 결과:**
```
녹음 중지 직후:
20251107_143000.wav (30 MB)

5초 후:
20251107_143000.aac (5 MB)  ← WAV 삭제됨
```

### C. 설정 기능

- [ ] **진료 시간표 설정**
  - "녹음 설정" 탭 클릭
  - 요일별 시간 설정
  - 저장 후 반영 확인

- [ ] **고급 설정**
  - "고급 설정" 버튼 클릭
  - WAV 자동 변환 옵션 확인
  - 보관 기간 설정
  - 저장 버튼 클릭

- [ ] **자동 실행 매니저**
  - "자동 실행" 탭 클릭
  - 프로그램 추가 (예: 메모장)
  - ON/OFF 토글 동작 확인

---

## ✅ 4단계: MSIX 특화 테스트

### A. FFmpeg 실행 확인 (중요!)

MSIX 샌드박스에서 FFmpeg가 정상 작동하는지 확인합니다.

- [ ] **WAV → AAC 변환 테스트**
  - 짧은 녹음 (1-2분) 진행
  - 녹음 중지
  - 5초 후 AAC 파일 생성 확인
  - 로그에 FFmpeg 오류 없음

**❌ 변환 실패 시:**
```
가능한 원인:
1. FFmpeg.exe가 assets/bin/에 포함되지 않음
2. MSIX에서 실행 파일 권한 문제
3. 경로 접근 권한 문제

해결:
1. pubspec.yaml의 assets 확인
2. FFmpeg 경로 로그 확인
```

### B. 앱 데이터 폴더 확인

- [ ] **앱 데이터 위치**
  ```
  Windows + R → shell:AppsFolder
  또는
  %LOCALAPPDATA%\Packages\eyebottle.medical.recorder_*\LocalState\
  ```

- [ ] **로그 파일 확인**
  - 로그 파일이 정상 생성됨
  - 앱 실행 기록 확인

- [ ] **설정 파일 확인**
  - shared_preferences 데이터 저장 확인

### C. 권한 테스트

- [ ] **마이크 권한**
  - Windows 설정 → 개인정보 → 마이크
  - "아이보틀 진료 녹음"이 목록에 표시됨
  - 권한이 "허용"으로 설정됨

- [ ] **파일 시스템 접근**
  - 사용자가 선택한 저장 폴더에 파일 생성 가능
  - OneDrive 폴더 접근 가능

---

## ✅ 5단계: 시스템 통합 테스트

### A. 작업 표시줄

- [ ] **최소화**
  - 창 최소화 → 작업 표시줄에 아이콘 표시
  - eyebottle 로고가 표시됨

- [ ] **시스템 트레이**
  - 시스템 트레이 아이콘 표시 (설정되어 있다면)
  - 우클릭 메뉴 동작

### B. 창 관리

- [ ] **크기 조절**
  - 창 크기 변경 가능
  - UI가 정상 표시됨

- [ ] **최대화/복원**
  - 최대화 버튼 동작
  - 복원 버튼 동작

### C. Alt+Tab

- [ ] **앱 전환**
  - Alt+Tab으로 앱 전환 시
  - eyebottle 로고가 표시됨
  - 앱 이름 "아이보틀 진료 녹음" 표시

---

## ✅ 6단계: 안정성 테스트

### A. 재시작 테스트

- [ ] **앱 종료 및 재시작**
  - 앱 정상 종료
  - 시작 메뉴에서 재실행
  - 이전 설정 유지됨

- [ ] **강제 종료**
  - 작업 관리자 → 프로세스 종료
  - 재시작 시 복구됨

### B. 장시간 실행

- [ ] **장시간 녹음** (10분+)
  - 10분 이상 녹음 진행
  - 세그먼트 분할 정상 작동
  - 각 세그먼트가 AAC로 변환됨
  - 메모리 누수 없음

---

## ✅ 7단계: 제거 테스트

### 제거 방법 1: 설정에서

```
Windows 설정 → 앱 → 설치된 앱
→ "아이보틀 진료 녹음" 검색
→ "..." 메뉴 → "제거" 클릭
```

### 제거 방법 2: PowerShell

```powershell
Remove-AppxPackage -Package eyebottle.medical.recorder_1.3.0.0_x64__*
```

### 확인 항목

- [ ] **제거 진행**
  - 오류 없이 제거됨
  - 완료 메시지 표시

- [ ] **시작 메뉴에서 제거**
  - "아이보틀 진료 녹음" 검색 시 없음

- [ ] **앱 데이터 확인**
  - `%LOCALAPPDATA%\Packages\` 폴더에서 앱 폴더 확인
  - 제거되었거나 남아있을 수 있음 (설정에 따라)

---

## ✅ 8단계: 재설치 테스트

### 재설치

```powershell
cd C:\ws-workspace\eyebottlelee\build\windows\x64\runner\Release
Add-AppxPackage -Path medical_recorder.msix
```

### 확인 항목

- [ ] **재설치 성공**
  - 오류 없이 재설치됨

- [ ] **초기 상태 확인**
  - 이전 설정이 남아있는지 확인
  - 또는 초기 상태로 시작하는지 확인

- [ ] **모든 기능 재확인**
  - 녹음, 설정, 자동 실행 등
  - 정상 작동 확인

---

## 🧪 선택적: WACK 테스트 (권장)

Windows App Certification Kit으로 MS Store 심사 기준을 사전 확인합니다.

### WACK 실행 방법

**방법 1: GUI**
```
시작 → "Windows App Cert Kit" 검색
→ 앱 실행
→ "Windows 데스크톱 앱 유효성 검사" 선택
→ medical_recorder.msix 선택
→ "다음" → 테스트 시작
```

**방법 2: 명령줄**
```powershell
appcert.exe test -apptype windowsapppackage -appxpackagepath "C:\ws-workspace\eyebottlelee\build\windows\x64\runner\Release\medical_recorder.msix" -reportoutputpath "C:\wack-report.xml"
```

**예상 소요 시간:** 10-15분

### 통과해야 할 테스트

- [ ] **App manifest compliance** - Manifest 규격 준수
- [ ] **App manifest resources** - 리소스 파일 존재
- [ ] **Windows security** - 보안 요구사항
- [ ] **Package sanity** - 패키지 무결성
- [ ] **Platform security** - 플랫폼 보안
- [ ] **Supported API** - 지원되는 API 사용
- [ ] **Performance** - 성능 기준 (시작 시간 등)

### ❌ 실패 시

**로그 확인:**
```
wack-report.xml 또는 HTML 리포트
```

**일반적인 문제:**
1. **Unsupported API**: Win32 API 사용 제한
2. **Missing resources**: 리소스 파일 누락
3. **Performance**: 시작 시간 초과 (5초 이상)

**해결:**
- 로그를 읽고 문제 파악
- 코드 수정 후 재빌드
- MSIX 재생성 후 재테스트

---

## ✅ 최종 체크리스트

전체 테스트 완료 확인:

### 필수 테스트
- [ ] 설치 성공
- [ ] 앱 실행 성공
- [ ] 녹음 기능 정상 작동
- [ ] **WAV → AAC 변환 정상 작동** (핵심!)
- [ ] 설정 저장/로드 정상
- [ ] 제거 성공
- [ ] 재설치 성공

### 권장 테스트
- [ ] FFmpeg 실행 확인
- [ ] 마이크 권한 정상
- [ ] 장시간 실행 안정성
- [ ] WACK 테스트 통과

### 시각적 확인
- [ ] 모든 아이콘이 eyebottle 로고로 표시
- [ ] 시작 메뉴 타일 정상
- [ ] 작업 표시줄 아이콘 정상
- [ ] Alt+Tab 아이콘 정상

---

## 🎯 테스트 완료 후

**모든 테스트 통과 시:**
✅ Phase 4 완료!
→ Phase 5 (MS Store 제출) 진행 가능

**문제 발견 시:**
1. 문제를 기록 (스크린샷, 로그)
2. 코드 수정
3. 재빌드 및 MSIX 재생성
4. 테스트 재진행

---

## 📞 문제 발생 시 확인 사항

### 일반적인 문제

**1. 설치 실패**
- 개발자 모드 확인
- 이전 버전 완전 제거
- PowerShell 관리자 권한

**2. FFmpeg 실행 안 됨**
- pubspec.yaml에 assets 등록 확인
- 빌드 출력 폴더에 ffmpeg.exe 존재 확인
- 경로 권한 확인

**3. 설정이 저장 안 됨**
- AppData 폴더 권한 확인
- shared_preferences 로그 확인

**4. 마이크 권한 오류**
- Windows 설정 → 마이크 권한 확인
- Manifest의 capabilities 확인

---

**테스트 시작 날짜:** _____________
**테스트 완료 날짜:** _____________
**테스트 결과:** ⬜ 통과  ⬜ 실패 (문제: _____________)
