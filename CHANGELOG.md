# Changelog

아이보틀 진료 녹음의 모든 주요 변경사항이 이 파일에 문서화됩니다.

형식은 [Keep a Changelog](https://keepachangelog.com/ko/1.0.0/)를 기반으로 하며,
이 프로젝트는 [Semantic Versioning](https://semver.org/lang/ko/)을 따릅니다.

---

## [1.3.4] - 2025-11-19

### ✨ 새로운 기능

#### 부팅 시 백그라운드 시작 옵션 추가
사용자 피드백을 반영하여 부팅 시 창을 표시하지 않고 트레이에서만 시작하는 옵션을 추가했습니다.

**새로운 설정:**
- ✅ "Windows 시작 시 앱 자동 실행" - PC 부팅 시 앱 자동 시작
- ✅ "부팅 시 백그라운드로 시작" - 창을 숨기고 트레이에서만 실행

**설정 위치:**
- 고급 설정 → Windows 시작 설정

**동작 방식:**
1. "Windows 시작 시 앱 자동 실행" 활성화 → 부팅 시 앱 자동 시작
2. "부팅 시 백그라운드로 시작" 활성화 → 창 숨김, 트레이 아이콘만 표시
3. 트레이 아이콘 클릭 → 창 복원

### 📦 패키지 정보

- **버전**: 1.3.4.0
- **크기**: ~83 MB
- **필수 OS**: Windows 10 버전 1809 이상

---

## [1.3.3] - 2025-11-19

### 🔧 버그 수정

#### MS Store 버전에서 윈도우 부팅 시 자동 시작 기능 완전 복구
v1.3.2에서 해결되지 않았던 부팅 시 자동 시작 기능을 완전히 수정했습니다.

**근본 원인:**
- v1.3.2에서 `packageName`만 추가했으나, **MSIX manifest에 StartupTask 선언이 누락**되어 있었음
- StartupTask가 manifest에 선언되어야 Windows가 해당 앱을 시작 프로그램으로 인식함

**수정사항:**
- ✅ `pubspec.yaml`에 **startup_task 섹션 추가** (MSIX manifest에 StartupTask 선언)
- ✅ `launch_at_startup` 패키지가 StartupTask를 제어할 수 있도록 연동 완료
- ✅ 앱 설정에서 부팅 시 자동 시작 on/off 제어 가능

**동작 방식:**
1. MSIX manifest에 StartupTask 선언 → Windows가 시작 프로그램으로 인식
2. `launch_at_startup` 패키지 → 사용자 설정에 따라 활성화/비활성화 제어

### 📦 패키지 정보

- **버전**: 1.3.3.0
- **크기**: ~83 MB
- **필수 OS**: Windows 10 버전 1809 이상

---

## [1.3.2] - 2025-11-19

### 🔧 버그 수정

#### MS Store 버전에서 부팅 시 자동 시작 기능 복구 (미완료)
MS Store에서 설치한 앱에서 부팅 시 자동 시작 기능이 동작하지 않는 문제를 수정 시도했으나, StartupTask manifest 선언 누락으로 완전히 해결되지 않았습니다. v1.3.3에서 완전 수정됨.

**수정사항:**
- `auto_launch_service.dart`에 Package Family Name 추가

### 📦 패키지 정보

- **버전**: 1.3.2.0
- **크기**: ~83 MB
- **필수 OS**: Windows 10 버전 1809 이상

---

## [1.3.1] - 2025-11-18

### 🎉 Microsoft Store 긴급 업데이트 출시 (2025-11-18)

**v1.3.1 긴급 버그 수정이 Microsoft Store에 출시되었습니다!**

- **제출 날짜**: 2025-11-18
- **승인 날짜**: 2025-11-18 (초고속! 같은 날 승인)
- **Submission ID**: Submission 2
- **다운로드 링크**: https://www.microsoft.com/store/apps/9NDZB0QSL928

### 🚨 긴급 버그 수정

#### 앱 시작 시 즉시 크래쉬 문제 해결 (진료실 PC와 동일 원인)
MS Store 출시 후 일부 사용자 환경에서 앱 시작 시 즉시 크래쉬되는 치명적 버그를 수정했습니다.

**근본 원인:**
- MSIX 패키지에 **Visual C++ Runtime dependencies 누락**
- record_windows 플러그인이 MSVCP140.dll을 로드하지 못해 즉시 크래쉬
- *(진료실 PC 크래쉬와 동일한 원인 - v1.2.8에서 수동 설치로 임시 해결)*

**수정사항:**
- ✅ **`dependencies: Microsoft.VCLibs.140.00.UWPDesktop` 추가** (핵심 수정!)
- ✅ `pubspec.yaml`에 `runFullTrust` 권한 추가
- ✅ `main.dart`에 전역 에러 핸들러 추가 (`runZonedGuarded`)
- ✅ 시스템 트레이 초기화 실패 로깅 개선
- ✅ 마이크 진단 초기화 오류 처리 강화

### 🔧 개선사항

#### 에러 핸들링 강화
- 전역 Zone 에러 핸들러로 모든 예외 캐치
- Flutter 프레임워크 에러를 명시적으로 처리
- 각 초기화 단계별 상세한 로그 기록

#### 복원력 향상
- 시스템 트레이 초기화 실패 시에도 앱 계속 실행
- 마이크 진단 실패 시에도 앱 계속 실행
- 핵심 기능 외 실패는 경고만 표시하고 앱 계속 진행

### 📦 패키지 정보

- **버전**: 1.3.1.0
- **크기**: ~83 MB
- **필수 OS**: Windows 10 버전 1809 이상

### 🎯 영향

- **크래쉬 발생률 예상 감소**: 95%+
- **영향받은 사용자**: MS Store v1.3.0 초기 설치자

---

## [1.3.0] - 2025-11-06

### 🎉 Microsoft Store 정식 출시 (2025-11-17)

**아이보틀 진료 녹음이 Microsoft Store에 공식 출시되었습니다!**

- **제출 날짜**: 2025-11-15
- **승인 날짜**: 2025-11-17 (2일 소요)
- **Store ID**: 9NDZB0QSL928
- **다운로드 링크**: https://www.microsoft.com/store/apps/9NDZB0QSL928

#### 출시 타임라인
```
2025-11-15: 제출 (Submission)
   ↓ (1-2시간)
2025-11-15: Pre-processing 완료
   ↓ (2일)
2025-11-17: Certification 통과
   ↓ (1시간)
2025-11-17: Microsoft Store 출시
```

#### Store 패키지 정보
- **버전**: 1.3.0.0
- **크기**: 83 MB
- **아키텍처**: x64
- **최소 OS**: Windows 10 버전 1809 (Build 17763)
- **지원 언어**: English (US), Korean
- **가격**: 무료
- **전세계 출시**: 240개국

#### 승인된 권한
- `microphone` (마이크 접근)
- `internetClient` (OneDrive 동기화)
- `runFullTrust` (데스크톱 앱 필수 권한)

> Microsoft Store를 통한 설치는 자동 업데이트와 Windows 보안 검증을 지원합니다.

---

### 🎉 주요 개선사항

#### WAV 자동 변환 완전 적용
녹음 중단 시에도 마지막 파일이 AAC로 자동 변환되도록 개선되었습니다. 이제 짧은 녹음이나 빈번한 중단 상황에서도 용량 절감(83%) 효과를 얻을 수 있습니다.

#### 공식 로고 적용
eyebottle.kr의 공식 로고가 앱 아이콘과 MSIX 패키지에 적용되었습니다.

### ✨ 새로운 기능

- **WAV → AAC 마지막 파일 변환**: 녹음 중지 시에도 마지막 세그먼트가 자동으로 AAC로 변환됩니다
  - 짧은 녹음 (1~2분)도 용량 절감 효과
  - 빈번한 중단 시나리오 최적화
  - 설정된 지연 시간 후 자동 변환 (기본 5초)

- **자동화 테스트 스크립트**:
  - `run-automated-test.ps1`: 성능 모니터링 및 파일 검증
  - `run-quick-validation.ps1`: 빠른 프로젝트 검증
  - `convert-logo-to-ico.ps1`: 로고 변환 도구

### 🐛 버그 수정

- **diagnostic_info_dialog.dart**: 필드 누락 문제 수정
- **코드 정리**: 사용되지 않는 변수 5개 제거
- **Flutter 분석**: 경고 58개 → 48개 (경고 0개, 정보만 48개)

### 🔧 개선사항

#### 코드 품질
- 디버그 로그 정리 (🔧, 🐛 이모지 로그 제거)
- 코드 포맷팅 완료 (`dart format`)
- 린트 자동 수정 (`dart fix --apply`)
- 불필요한 import 제거

#### 성능
- Release 빌드 시간: 34.6초
- 실행 파일 크기: 91 KB (런처)
- 초기 메모리 사용량: ~150 MB

#### 문서화
- Phase 2 자동화 테스트 결과 문서
- 수동 테스트 가이드 작성
- MS Store 출시 가이드 업데이트

### 📦 의존성 업데이트

- `record: 6.1.1 → 6.1.2`
- `record_android: 1.4.2 → 1.4.4`
- `record_ios: 1.1.2 → 1.1.4`
- `record_macos: 1.1.1 → 1.1.2`

### 🎨 리소스

- **아이콘**: eyebottle.kr 공식 로고 (171.82 KB, 7개 해상도)
- **이미지**: PNG 1024x1024 (175.39 KB)
- **MSIX 버전**: 1.3.0.0

### 🧪 테스트

#### 자동화 테스트 (✅ 통과)
- 필수 파일 확인 (5/5)
- 서비스 파일 확인 (9/9)
- 의존성 확인 (7/7)
- Flutter 분석 (경고 0개)
- Release 빌드 성공

#### 수동 테스트 필요
- UI 테스트 (볼륨 미터, 버튼 반응)
- 음성 재생 확인
- 시간표 자동 녹음
- 자동 실행 매니저
- 성능 테스트 (장시간 녹음)

### 🔗 관련 문서

- [MS Store 출시 가이드](docs/MS-STORE-GUIDE.md)
- [Phase 2 테스트 결과](docs/test-results-phase2.md)
- [수동 테스트 가이드](docs/manual-test-guide.md)

---

## [1.2.0] - 2025-10-XX

### 이전 버전
이전 버전의 변경사항은 별도로 문서화되지 않았습니다.

---

## 범례

- 🎉 **주요 개선사항**: 사용자에게 큰 영향을 주는 변경
- ✨ **새로운 기능**: 새로 추가된 기능
- 🐛 **버그 수정**: 수정된 버그
- 🔧 **개선사항**: 기존 기능의 개선
- 📦 **의존성**: 라이브러리 업데이트
- 🎨 **리소스**: 디자인 및 에셋 변경
- 🧪 **테스트**: 테스트 관련 변경
- 📝 **문서**: 문서 업데이트
- ⚠️ **중요**: 주의가 필요한 변경사항
- 🔒 **보안**: 보안 관련 수정
